from datetime import datetime
import sqlite3


# Чётные недели
even_weeks = [
    ("01.09.25", "07.09.25"),
    ("15.09.25", "21.09.25"),
    ("29.09.25", "05.10.25"),
    ("13.10.25", "19.10.25"),
    ("27.10.25", "02.11.25"),
    ("10.11.25", "16.11.25"),
    ("24.11.25", "30.11.25"),
    ("08.12.25", "14.12.25"),
    ("22.12.25", "28.12.25"),
    ("05.01.26", "11.01.26"),
    ("19.01.26", "25.01.26"),
    ("02.02.26", "08.02.26"),
    ("16.02.26", "22.02.26"),
    ("02.03.26", "08.03.26"),
    ("16.03.26", "22.03.26"),
    ("30.03.26", "05.04.26"),
    ("13.04.26", "19.04.26"),
    ("27.04.26", "03.05.26"),
    ("11.05.26", "17.05.26"),
    ("25.05.26", "31.05.26"),
    ("08.06.26", "14.06.26"),
    ("22.06.26", "28.06.26")
]

# Нечётные недели
odd_weeks = [
    ("08.09.25", "14.09.25"),
    ("22.09.25", "28.09.25"),
    ("06.10.25", "12.10.25"),
    ("20.10.25", "26.10.25"),
    ("03.11.25", "09.11.25"),
    ("17.11.25", "23.11.25"),
    ("01.12.25", "07.12.25"),
    ("15.12.25", "21.12.25"),
    ("29.12.25", "04.01.26"),
    ("12.01.26", "18.01.26"),
    ("26.01.26", "01.02.26"),
    ("09.02.26", "15.02.26"),
    ("23.02.26", "01.03.26"),
    ("09.03.26", "15.03.26"),
    ("23.03.26", "29.03.26"),
    ("06.04.26", "12.04.26"),
    ("20.04.26", "26.04.26"),
    ("04.05.26", "10.05.26"),
    ("18.05.26", "24.05.26"),
    ("01.06.26", "07.06.26"),
    ("15.06.26", "21.06.26"),
    ("29.06.26", "05.07.26")
]

def get_russian_day_name(english_day_name):
    """
    Получить русское название дня недели
    """
    days_mapping = {
        'monday': 'Понедельник',
        'tuesday': 'Вторник',
        'wednesday': 'Среда', 
        'thursday': 'Четверг',
        'friday': 'Пятница',
        'saturday': 'Суббота',
        'sunday': 'Воскресенье'
    }
    return days_mapping.get(english_day_name.lower(), english_day_name)

# Преобразование строк в datetime.date
def parse_weeks(week_list):
    result = []
    for start, end in week_list:
        start_dt = datetime.strptime(start, "%d.%m.%y").date()
        end_dt = datetime.strptime(end, "%d.%m.%y").date()
        result.append((start_dt, end_dt))
    return result

even_weeks = parse_weeks(even_weeks)
odd_weeks = parse_weeks(odd_weeks)


def get_week_type(target_date=None):
    """
    Определяет тип недели (чётная/нечётная) для указанной даты.
    Если дата не указана, используется текущая дата.
    """
    if target_date is None:
        target_date = datetime.today().date()
    
    # Начальная точка отсчета - первая неделя сентября (нечётная)
    start_date = datetime(2024, 9, 2).date()  # Первый понедельник сентября
    
    # Вычисляем разницу в неделях
    delta = target_date - start_date
    weeks_passed = delta.days // 7
    
    # Если прошло четное количество недель - нечётная, нечетное - чётная
    return "even" if weeks_passed % 2 == 1 else "odd"


def get_week_type(date):
    """
    Определяет тип недели по дате.
    date: datetime.date
    Возвращает: "even" / "odd" / None (если дата не входит ни в один диапазон)
    """
    for start, end in even_weeks:
        if start <= date <= end:
            return "even"
    for start, end in odd_weeks:
        if start <= date <= end:
            return "odd"
    return None

